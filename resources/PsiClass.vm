package $packageName;

import com.intellij.lang.ASTNode;
import com.intellij.lang.LightPsiParser;
import com.intellij.lang.PsiBuilder;
import com.intellij.lang.PsiParser;
import com.intellij.psi.TokenType;
import com.intellij.psi.tree.IElementType;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public $classModifiers class $className extends $superclass {

    #foreach($nodeGetter in $nodeGetters)
    public $nodeGetter.nodeType ${nodeGetter.getterName}() {
            return ($nodeGetter.nodeType)(getChildren()[$nodeGetter.childIndex]);
        }
    #end


    ##
    ## optionals
    ##

    #if ($isOptionalAbstract)

        public abstract $operandType $optionalOperandGetterName();

    #elseif ($isOptionalAbsentCase)

        public $operandType $optionalOperandGetterName() {
            return null;
        }

    #elseif ($isOptionalPresentCase)

        ## the normal getter will override the abstract method form the parent class

    #end


    ##
    ## repetitions
    ##

    #if ($isRepetitionAbstract)

        public abstract ImmutableList<$operandType> getAll();

        public void addAllTo(List<$operandType> list);

        public void addAllTo(ImmutableList.Builder<$operandType> builder);

    #elseif ($isRepetitionBaseCase)

        public ImmutableList<$operandType> getAll() {
            #if ($isZeroBasedRepetition)
                return ImmutableList.of();
            #else
                return ImmutableList.of(getElement());
            #end
        }

        public void addAllTo(List<$operandType> list) {
            #if (!$isZeroBasedRepetition)
                list.add(getElement());
            #end
        }

        public void addAllTo(ImmutableList.Builder<$operandType> builder) {
            #if (!$isZeroBasedRepetition)
                builder.add(getElement());
            #end
        }

    #elseif ($isRepetitionNextCase)

        public ImmutableList<$operandType> getAll() {
            ImmutableList.Builder<$operandType> builder = ImmutableList.builder();
            addAllTo(builder);
            return builder.build();
        }

        public void addAllTo(List<$operandType> list) {
            getPrevious().addAllTo(list);
            list.add(getElement());
        }

        public void addAllTo(ImmutableList.Builder<$operandType> builder) {
            getPrevious().addAllTo(builder);
            builder.add(getElement());
        }

    #end

}
